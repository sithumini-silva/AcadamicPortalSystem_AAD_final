<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduChamp - Exam Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --sidebar-width: 250px;
            --topbar-height: 70px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark-color);
            overflow-x: hidden;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(120deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo h1 {
            font-weight: 700;
            font-size: 1.8rem;
            margin: 0;
        }

        .logo i {
            margin-right: 10px;
            font-size: 2rem;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info span {
            margin-right: 10px;
            font-weight: 500;
        }

        .user-info i {
            font-size: 1.5rem;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            gap: 20px;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            border-radius: 12px;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            height: fit-content;
        }

        .sidebar h4 {
            color: var(--primary-color);
            padding: 0 20px 15px;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            text-align: center;
        }

        .sidebar a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--dark-color);
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .sidebar a:hover, .sidebar a.active {
            background-color: rgba(67, 97, 238, 0.08);
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }

        .sidebar a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .page-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
        }

        .page-title i {
            margin-right: 10px;
        }

        /* Form Styling */
        .form-label {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 8px;
        }

        .form-control {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px 15px;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }

        /* Button Styles */
        .btn {
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn i {
            margin-right: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
        }

        .btn-warning {
            background: linear-gradient(45deg, #ff9e00, #ff6b00);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff0054, #d1004b);
        }

        .btn-info {
            background: linear-gradient(45deg, #00b4d8, #0077b6);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Table Styles */
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-top: 30px;
        }

        .table {
            border-radius: 10px;
            overflow: hidden;
            margin: 0;
        }

        .table thead {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .table th {
            padding: 15px;
            font-weight: 600;
            border: none;
        }

        .table td {
            padding: 15px;
            vertical-align: middle;
            border-color: #f0f0f0;
        }

        .table tbody tr {
            transition: var(--transition);
        }

        .table tbody tr:hover {
            background-color: rgba(67, 97, 238, 0.05);
            cursor: pointer;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .main-content {
                order: 1;
            }
        }

        @media (max-width: 576px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .user-info {
                margin-top: 10px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* Animation for alerts */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert {
            animation: fadeIn 0.3s ease;
            border: none;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* Status indicators */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background-color: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
        }

        .status-upcoming {
            background-color: rgba(255, 158, 0, 0.2);
            color: #ff9e00;
        }

        .status-completed {
            background-color: rgba(247, 37, 133, 0.2);
            color: #f72585;
        }
    </style>
</head>
<body>
<!-- Header with EduChamp branding -->
<header class="header">
    <div class="header-content">
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <h1>EduChamp</h1>
        </div>
        <div class="user-info">
            <span>Welcome, Admin</span>
            <i class="fas fa-user-circle"></i>
        </div>
    </div>
</header>

<div class="main-container">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <h4>Admin Panel</h4>
        <a href="../index.html"><i class="fas fa-home"></i> Home</a>
        <a href="../static/teacherDash.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        <a href="user.html"><i class="fas fa-user"></i> User</a>
        <a href="exam.html" class="active"><i class="fas fa-file-alt"></i> Exam</a>
        <a href="viewExam.html"><i class="fas fa-list"></i> View Exam</a>
        <a href="result.html"><i class="fas fa-chart-line"></i> Result</a>
        <a href="question.html"><i class="fas fa-question-circle"></i> Question</a>
        <a href="paper2.html"><i class="fas fa-copy"></i> Paper</a>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <h2 class="page-title"><i class="fas fa-file-alt"></i> Exam Management</h2>

        <form class="row g-3" id="examForm">
            <div class="col-md-6">
                <label for="exam_id" class="form-label">Exam ID:</label>
                <input type="text" class="form-control" id="exam_id" required readonly>
            </div>
            <div class="col-md-6">
                <label for="duration" class="form-label">Duration (hours):</label>
                <input type="number" class="form-control" id="duration" placeholder="Enter exam duration" min="1">
            </div>
            <div class="col-md-12">
                <label for="description" class="form-label">Description:</label>
                <textarea class="form-control" id="description" rows="3" placeholder="Enter exam description"></textarea>
            </div>
            <div class="col-md-6">
                <label for="startDate" class="form-label">Start Date:</label>
                <input type="datetime-local" class="form-control" id="startDate">
            </div>
            <div class="col-md-6">
                <label for="endDate" class="form-label">End Date:</label>
                <input type="datetime-local" class="form-control" id="endDate">
            </div>

            <div class="col-12 action-buttons">
                <button type="button" class="btn btn-primary" onclick="saveExam()"><i class="fas fa-save"></i> Save</button>
                <button type="button" class="btn btn-warning" onclick="updateExam()"><i class="fas fa-edit"></i> Update</button>
                <button type="button" class="btn btn-danger" onclick="deleteExam()"><i class="fas fa-trash"></i> Delete</button>
                <button type="button" class="btn btn-info" onclick="viewExams()"><i class="fas fa-eye"></i> View Exams</button>
            </div>
        </form>

        <div class="table-container">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Exam ID</th>
                    <th>Duration</th>
                    <th>Description</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody id="examTableBody">
                <tr>
                    <td colspan="6" class="text-center">No exams to display. Click "View Exams" to load data.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script>
    $(document).ready(function () {
        loadNextExamId();
        setupRowClickListener();
    });

    function getToken() {
        return localStorage.getItem("jwtToken");
    }

    function setupRowClickListener() {
        $(document).on("click", "#examTableBody tr", function () {
            // Skip if it's the "no data" row
            if ($(this).find('td').length === 1) return;

            let selectedRow = $(this).children("td");
            $('#exam_id').val(selectedRow.eq(0).text());
            $('#duration').val(selectedRow.eq(1).text().replace(' hours', ''));
            $('#description').val(selectedRow.eq(2).text());
            $('#startDate').val(formatDateForInput(selectedRow.eq(3).text()));
            $('#endDate').val(formatDateForInput(selectedRow.eq(4).text()));
        });
    }

    function formatDateForInput(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toISOString().slice(0, 16);
    }

    function saveExam() {
        const exam = {
            duration: $('#duration').val(),
            description: $('#description').val(),
            startDate: $('#startDate').val(),
            endDate: $('#endDate').val()
        };

        // Basic validation
        if (!exam.duration || !exam.description || !exam.startDate || !exam.endDate) {
            alert("Please fill in all fields!");
            return;
        }

        $.ajax({
            url: "http://localhost:8080/api/v1/exam/create",
            method: "POST",
            contentType: "application/json",
            headers: {
                "Authorization": "Bearer " + getToken()
            },
            data: JSON.stringify(exam),
            success: function(response) {
                alert("Exam created successfully!");
                loadNextExamId();
                viewExams();
                clearForm();
            },
            error: function(xhr) {
                alert("Error creating exam! " + xhr.responseText);
            }
        });
    }

    function clearForm() {
        $('#duration').val('');
        $('#description').val('');
        $('#startDate').val('');
        $('#endDate').val('');
    }

    function loadNextExamId() {
        $.ajax({
            url: "http://localhost:8080/api/v1/exam/next-id",
            method: "GET",
            headers: {
                "Authorization": "Bearer " + getToken()
            },
            success: function(response) {
                $('#exam_id').val(response);
            },
            error: function(xhr) {
                alert("Error loading exam ID! " + xhr.responseText);
            }
        });
    }

    function viewExams() {
        $.ajax({
            url: "http://localhost:8080/api/v1/exam/get",
            method: "GET",
            headers: {
                "Authorization": "Bearer " + getToken()
            },
            success: function(response) {
                let tableBody = $("#examTableBody");
                tableBody.empty();

                if (response && Array.isArray(response) && response.length > 0) {
                    response.forEach(exam => {
                        const status = getExamStatus(exam.startDate, exam.endDate);
                        tableBody.append(`
                                <tr>
                                    <td>${exam.id}</td>
                                    <td>${exam.duration} mins</td>
                                    <td>${exam.description}</td>
                                    <td>${formatDateTime(exam.startDate)}</td>
                                    <td>${formatDateTime(exam.endDate)}</td>
                                    <td><span class="status-badge status-${status}">${status}</span></td>
                                </tr>
                            `);
                    });
                } else {
                    tableBody.append(`
                            <tr>
                                <td colspan="6" class="text-center">No exams found</td>
                            </tr>
                        `);
                }
            },
            error: function(xhr) {
                alert("Error fetching exams! " + xhr.responseText);
            }
        });
    }

    function formatDateTime(dateString) {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        return date.toLocaleString();
    }

    function getExamStatus(startDate, endDate) {
        const now = new Date();
        const start = new Date(startDate);
        const end = new Date(endDate);

        if (now < start) return 'upcoming';
        if (now > end) return 'completed';
        return 'active';
    }

    function updateExam() {
        const examId = $('#exam_id').val();
        if (!examId) {
            alert("Please select an exam to update!");
            return;
        }

        const exam = {
            duration: $('#duration').val(),
            description: $('#description').val(),
            startDate: $('#startDate').val(),
            endDate: $('#endDate').val()
        };

        $.ajax({
            url: "http://localhost:8080/api/v1/exam/update/" + examId,
            method: "PUT",
            contentType: "application/json",
            headers: {
                "Authorization": "Bearer " + getToken()
            },
            data: JSON.stringify(exam),
            success: function(response) {
                alert("Exam updated successfully!");
                viewExams();
            },
            error: function(xhr) {
                alert("Error updating exam! " + xhr.responseText);
            }
        });
    }

    function deleteExam() {
        const examId = $('#exam_id').val();
        if (!examId) {
            alert("Please select an exam to delete!");
            return;
        }

        if (!confirm("Are you sure you want to delete this exam?")) {
            return;
        }

        $.ajax({
            url: "http://localhost:8080/api/v1/exam/delete/" + examId,
            method: "DELETE",
            headers: {
                "Authorization": "Bearer " + getToken()
            },
            success: function(response) {
                alert("Exam deleted successfully!");
                viewExams();
                clearForm();
                loadNextExamId();
            },
            error: function(xhr) {
                alert("Error deleting exam! " + xhr.responseText);
            }
        });
    }
</script>
</body>
</html>